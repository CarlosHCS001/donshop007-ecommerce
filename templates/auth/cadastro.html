{% extends "base.html" %}

{% block title %}Cadastro - DonShop007{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-md-5">
            <div class="card shadow">
                <div class="card-body p-5">
                    <h2 class="text-center mb-4 text-navy">Criar Conta</h2>
                    
                    <form method="POST" id="cadastroForm" novalidate>
                        <div class="mb-3">
                            <label for="nome" class="form-label">Nome Completo</label>
                            <input type="text" class="form-control" id="nome" name="nome" required minlength="5">
                            <div class="invalid-feedback" id="nome-error"></div>
                            <small class="text-muted">Mínimo 5 caracteres, apenas letras</small>
                        </div>

                        <div class="mb-3">
                            <label for="email" class="form-label">Email</label>
                            <input type="email" class="form-control" id="email" name="email" required>
                            <div class="invalid-feedback" id="email-error"></div>
                        </div>

                        <div class="mb-3">
                            <label for="senha" class="form-label">Senha</label>
                            <input type="password" class="form-control" id="senha" name="senha" required minlength="6">
                            <div class="invalid-feedback" id="senha-error"></div>
                            <small class="text-muted">Mínimo 6 caracteres, com letra e número</small>
                        </div>

                        <div class="mb-4">
                            <label for="confirmar_senha" class="form-label">Confirmar Senha</label>
                            <input type="password" class="form-control" id="confirmar_senha" name="confirmar_senha" required>
                            <div class="invalid-feedback" id="confirmar-error"></div>
                        </div>

                        <button type="submit" class="btn btn-rose w-100" id="btnCadastro">Criar Conta</button>
                    </form>

                    <div class="text-center mt-4">
                        <p class="text-muted">
                            Já tem uma conta?
                            <a href="{{ url_for('auth.login') }}" class="text-rose">Faça login</a>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.getElementById('cadastroForm').addEventListener('submit', function(e) {
    let valido = true;

    // limpa erros anteriores
    document.querySelectorAll('.form-control').forEach(el => el.classList.remove('is-invalid'));

    const nome = document.getElementById('nome');
    const email = document.getElementById('email');
    const senha = document.getElementById('senha');
    const confirmar = document.getElementById('confirmar_senha');

    // valida nome - minimo 3 chars, só letras e espaços
    const nomeRegex = /^[A-Za-zÀ-ÿ\s]{3,}$/;
    if (!nomeRegex.test(nome.value.trim())) {
        nome.classList.add('is-invalid');
        document.getElementById('nome-error').textContent = 'Nome deve ter no mínimo 3 caracteres e apenas letras';
        valido = false;
    }

    // valida email
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailRegex.test(email.value.trim())) {
        email.classList.add('is-invalid');
        document.getElementById('email-error').textContent = 'Digite um email válido';
        valido = false;
    }

    // valida senha - minimo 6 chars, pelo menos 1 letra e 1 numero
    const senhaRegex = /^(?=.*[A-Za-z])(?=.*\d).{6,}$/;
    if (!senhaRegex.test(senha.value)) {
        senha.classList.add('is-invalid');
        document.getElementById('senha-error').textContent = 'Senha deve ter no mínimo 6 caracteres, com letra e número';
        valido = false;
    }

    // valida confirmação
    if (senha.value !== confirmar.value) {
        confirmar.classList.add('is-invalid');
        document.getElementById('confirmar-error').textContent = 'As senhas não coincidem';
        valido = false;
    }

    if (!valido) {
        e.preventDefault();
    }
});

// validação em tempo real
document.getElementById('nome').addEventListener('blur', function() {
    const nomeRegex = /^[A-Za-zÀ-ÿ\s]{3,}$/;
    if (this.value && !nomeRegex.test(this.value.trim())) {
        this.classList.add('is-invalid');
        document.getElementById('nome-error').textContent = 'Nome deve ter no mínimo 3 caracteres e apenas letras';
    } else {
        this.classList.remove('is-invalid');
    }
});

document.getElementById('email').addEventListener('blur', function() {
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (this.value && !emailRegex.test(this.value.trim())) {
        this.classList.add('is-invalid');
        document.getElementById('email-error').textContent = 'Digite um email válido';
    } else {
        this.classList.remove('is-invalid');
    }
});

document.getElementById('senha').addEventListener('blur', function() {
    const senhaRegex = /^(?=.*[A-Za-z])(?=.*\d).{6,}$/;
    if (this.value && !senhaRegex.test(this.value)) {
        this.classList.add('is-invalid');
        document.getElementById('senha-error').textContent = 'Senha deve ter no mínimo 6 caracteres, com letra e número';
    } else {
        this.classList.remove('is-invalid');
    }
});

document.getElementById('confirmar_senha').addEventListener('blur', function() {
    const senha = document.getElementById('senha').value;
    if (this.value && this.value !== senha) {
        this.classList.add('is-invalid');
        document.getElementById('confirmar-error').textContent = 'As senhas não coincidem';
    } else {
        this.classList.remove('is-invalid');
    }
});
</script>
{% endblock %}
